<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Runner Game</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body {
    display:flex; justify-content:center; align-items:center;
    height:100vh; background-color:white; overflow:hidden;
    flex-direction:column; position:relative; touch-action: manipulation;
}
canvas { background-color:white; display:block; }
#groundContainer {
    position:absolute; bottom:0; width:100%; height:25%;
    background-color:black; display:flex; justify-content:center; align-items:center;
}
#jumpButton {
    width:120px; height:120px; border-radius:50%;
    background-color:blue; color:white; font-size:20px; font-weight:bold;
    border:none; cursor:pointer;
}
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<div id="groundContainer">
    <button id="jumpButton">ПРЫЖОК</button>
</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight * 0.75;
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

const groundHeight = canvas.height * 0.2;
const groundLevel = canvas.height - groundHeight;

let player = { x:80, y:groundLevel-80, width:100, height:100, dy:0, jumping:false };
let obstacles = [];
let gameSpeed = 6;
let gravity = 0.6;
let jumpPower = -14;
let obstacleTimer = 0;
let obstacleInterval = 80;
let jumpCount = 0;

// Изображения
const playerImage = new Image();
playerImage.src = "https://cdn.pixabay.com/photo/2024/02/06/12/28/ai-generated-8556930_1280.png";
const bushImage = new Image();
bushImage.src = "https://gas-kvas.com/uploads/posts/2023-02/1676434620_gas-kvas-com-p-kustik-detskii-risunok-3.jpg";

// Game Over
function gameOver() {
    alert("Game Over! Ваш счёт: " + jumpCount);
    document.location.reload();
}

function update() {
    player.y += player.dy;
    player.dy += gravity;

    if(player.y + player.height >= groundLevel){
        player.y = groundLevel - player.height;
        player.dy = 0;
        player.jumping = false;
    }

    for(let i=0;i<obstacles.length;i++){
        obstacles[i].x -= gameSpeed;

        let hitbox = {
            x: obstacles[i].x+10,
            y: obstacles[i].y+10,
            width: obstacles[i].width-20,
            height: obstacles[i].height-20
        };

        if(player.x + player.width > hitbox.x &&
           player.x < hitbox.x + hitbox.width &&
           player.y + player.height > hitbox.y){
               gameOver();
        }
    }

    obstacles = obstacles.filter(o=>o.x+o.width>0);

    if(obstacleTimer <= 0){
        let minGap = 180;
        let maxGap = 350;
        let randomGap = minGap + Math.random()*(maxGap-minGap);
        obstacles.push({ x: canvas.width + randomGap, y: groundLevel-60, width:80, height:60 });
        obstacleTimer = obstacleInterval;
    } else obstacleTimer--;
}

function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle = "black";
    ctx.fillRect(0, groundLevel, canvas.width, groundHeight);

    ctx.drawImage(playerImage, player.x, player.y, player.width, player.height);

    for(let obs of obstacles){
        ctx.drawImage(bushImage, obs.x, obs.y, obs.width, obs.height);
    }
}

function gameLoop(){
    update();
    draw();
    requestAnimationFrame(gameLoop);
}

gameLoop();

// Прыжок
function jump(){
    if(!player.jumping){
        player.dy = jumpPower;
        player.jumping = true;
        jumpCount++;
        if(jumpCount % 6 === 0) gameSpeed++;
    }
}

document.getElementById("jumpButton").addEventListener("click", jump);
document.addEventListener("keydown",(e)=>{if(e.code==="Space") jump();});
document.addEventListener("gesturestart",(e)=>e.preventDefault());
</script>
</body>
</html>
