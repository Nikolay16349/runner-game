<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Runner Mini-Game</title>
<style>
html, body { margin:0; padding:0; width:100%; height:100%; overflow:hidden; background:#0f0f12; color:#fff; font-family:Arial, sans-serif; }
canvas { display:block; width:100%; height:100%; }
#overlay, #gameOver {
  position:fixed; inset:0; z-index:10; display:flex; flex-direction:column; align-items:center; justify-content:center;
  background: rgba(0,0,0,0.5); text-align:center; gap:12px;
}
button { padding:12px 18px; border:none; border-radius:10px; background:#6c5ce7; color:white; font-weight:600; cursor:pointer; }
.hidden { display:none; }
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>

<div id="overlay">
  <h1>Runner</h1>
  <p>Тапни/нажми, чтобы прыгнуть. Избегай препятствий!</p>
  <button id="startBtn">Играть</button>
</div>

<div id="gameOver" class="hidden">
  <h2>Game Over</h2>
  <p id="finalScore">Счёт: 0</p>
  <p id="bestScore">Рекорд: 0</p>
  <button id="restartBtn">Ещё раз</button>
</div>

<script>
window.addEventListener('load', function(){
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');
  const overlay = document.getElementById('overlay');
  const startBtn = document.getElementById('startBtn');
  const gameOverEl = document.getElementById('gameOver');
  const restartBtn = document.getElementById('restartBtn');
  const finalScoreEl = document.getElementById('finalScore');
  const bestScoreEl = document.getElementById('bestScore');

  let player, obstacles=[], score=0, best=Number(localStorage.getItem('runner_best_score')||0), speed=5, running=false;

  function resizeCanvas(){ canvas.width=window.innerWidth; canvas.height=window.innerHeight; }
  window.addEventListener('resize', resizeCanvas);
  resizeCanvas();

  function resetGame(){
    player = {x:50, y:canvas.height-100, w:50, h:50, vy:0, onGround:true};
    obstacles=[];
    score=0;
    speed=5;
    running=true;
  }

  function startGame(){ overlay.classList.add('hidden'); gameOverEl.classList.add('hidden'); resetGame(); }
  function endGame(){ running=false; best=Math.max(best,score); localStorage.setItem('runner_best_score',best); finalScoreEl.textContent='Счёт: '+score; bestScoreEl.textContent='Рекорд: '+best; gameOverEl.classList.remove('hidden'); }

  startBtn.addEventListener('click', startGame);
  restartBtn.addEventListener('click', startGame);

  document.addEventListener('keydown', e=>{ if(e.code==='Space'||e.code==='ArrowUp') jump(); });
  canvas.addEventListener('touchstart', jump);

  function jump(){ if(player.onGround){ player.vy=-12; player.onGround=false; } }

  function spawnObstacle(){
    const size = 50;
    obstacles.push({x:canvas.width, y:canvas.height-100, w:size, h:size});
  }

  let spawnTimer=0;
  function update(dt){
    if(!running) return;
    player.vy += 0.5; // gravity
    player.y += player.vy;
    if(player.y+player.h>=canvas.height-50){ player.y=canvas.height-50-player.h; player.vy=0; player.onGround=true; }

    spawnTimer+=dt;
    if(spawnTimer>1000){ spawnTimer=0; spawnObstacle(); }

    obstacles.forEach(o=>o.x-=speed);
    obstacles = obstacles.filter(o=>o.x+o.w>0);

    // collision
    for(let o of obstacles) if(player.x<o.x+o.w && player.x+player.w>o.x && player.y<o.y+o.h && player.y+player.h>o.y){ endGame(); }

    score+=0.1;
  }

  function draw(){
    ctx.fillStyle='#0f0f12'; ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle='#4fc3f7'; ctx.fillRect(player.x,player.y,player.w,player.h);
    ctx.fillStyle='#ff7675';
    obstacles.forEach(o=>ctx.fillRect(o.x,o.y,o.w,o.h));
    ctx.fillStyle='white'; ctx.font='20px Arial'; ctx.fillText('Счёт: '+Math.floor(score),10,30); ctx.fillText('Рекорд: '+best,10,60);
  }

  let last=performance.now();
  function loop(){
    let now=performance.now();
    let dt=now-last; last=now;
    update(dt);
    draw();
    requestAnimationFrame(loop);
  }
  loop();
});
</script>
</body>
</html>
